# Custom Windmill worker image with paias package pre-installed
# This eliminates the need to copy src/ to u/admin/research_lib/

FROM ghcr.io/windmill-labs/windmill:main

# Set working directory
WORKDIR /app

# Copy only the files needed for package installation
COPY pyproject.toml /app/
COPY paias/ /app/paias/

# Install the paias package in editable mode
# Windmill uses uv for Python package management
# Use --break-system-packages to allow installation in the global environment
# Added retries for network resilience
RUN /usr/local/bin/uv pip install --system --break-system-packages -e /app \
    || /usr/local/bin/uv pip install --system --break-system-packages -e /app \
    || /usr/local/bin/uv pip install --system --break-system-packages -e /app

# Note: paias will be available when Windmill runs Python scripts
# Environment variables are passed via docker-compose.yml

# The rest of the Windmill configuration is inherited from the base image
